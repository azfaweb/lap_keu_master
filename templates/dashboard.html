{% extends 'layout.html' %}

{% block content %}
<h2>Daftar Proyek</h2>

<div class="d-flex justify-content-start mb-3">
  {% if current_user.role == 'admin' %}
    <a href="{{ url_for('setup_project') }}" class="btn btn-success me-2">Tambah Proyek Baru</a>
    <a href="{{ url_for('add_user') }}" class="btn btn-primary me-2">Tambah User</a>
    <a href="{{ url_for('list_users') }}" class="btn btn-info me-2">Daftar User</a>
  {% endif %}
  <a href="{{ url_for('export_projects_excel') }}" class="btn btn-outline-success me-2">Export Semua ke Excel</a>
  <a href="{{ url_for('export_projects_pdf') }}" class="btn btn-outline-danger">Export Semua ke PDF</a>
</div>

<table class="table table-striped table-bordered">
  <thead class="table-dark">
    <tr>
      <th>Nama Proyek</th>
      <th>Entitas A</th>
      <th>Porsi A (%)</th>
      <th>Pembagian A (Rp)</th>
      <th>Entitas B</th>
      <th>Porsi B (%)</th>
      <th>Pembagian B (Rp)</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody>
    {% for project in projects %}
    <tr>
      <td>{{ project.project_name }}</td>
      <td>{{ project.entity_a }}</td>
      <td>{{ project.porsia * 100 | int }}</td>
      <td>Rp {{ "{:,.0f}".format(project.nilai_a or 0) }}</td>
      <td>{{ project.entity_b }}</td>
      <td>{{ project.porsib * 100 | int }}</td>
      <td>Rp {{ "{:,.0f}".format(project.nilai_b or 0) }}</td>
      <td>
        <a href="{{ url_for('view_project', project_id=project.id) }}" class="btn btn-primary btn-sm">Lihat</a>
        {% if current_user.role == 'admin' %}
          <a href="{{ url_for('edit_project', project_id=project.id) }}" class="btn btn-warning btn-sm">Edit</a>
          <a href="{{ url_for('delete_project', project_id=project.id) }}" class="btn btn-danger btn-sm" onclick="return confirm('Yakin?')">Delete</a>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}